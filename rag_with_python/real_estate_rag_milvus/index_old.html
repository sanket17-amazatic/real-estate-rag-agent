<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property AI Guru - Real Estate Assistant</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            height: auto;
            overflow: auto;
        }

        .sidebar {
            width: 280px;
            background: #202124;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-right: 1px solid #23272A;
            box-shadow: 2px 0 15px rgba(0,0,0,0.18);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(30, 58, 95, 0.5);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #42a5f5;
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #64b5f6;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .sidebar-header h3 {
            color: #B0B3B8;
            font-size: 0.95em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quick-filters {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-btn {
            padding: 12px 16px;
            background: #23272A;
            border: 1px solid #23272A;
            color: #E0E0E0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            text-align: left;
        }

        .filter-btn:hover {
            background: #292B2F;
            color: #fff;
            border-color: #292B2F;
            transform: translateX(5px);
        }

        .filter-btn.active {
            background: #313338;
            color: #fff;
            border-color: #313338;
        }

        .sidebar-divider {
            height: 1px;
            background: rgba(100, 181, 246, 0.2);
            margin: 10px 0;
        }

        .info-box {
            background: #23272A;
            border-left: 3px solid #313338;
            padding: 12px 12px;
            border-radius: 8px;
            font-size: 0.8em;
            color: #B0B3B8;
            line-height: 1.5;
        }

        .main-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            margin-left: 280px;
            background: #181A1B;
        }

        .container {
            width: 100%;
            max-width: 100%;
            background: #23272A;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
            border: none;
        }

        .header {
            background: #181A1B;
            color: #E0E0E0;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
            border-bottom: 2px solid #23272A;
        }

        .header-left h1 {
            font-size: 2em;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 8px;
            color: #F5F6FA;
        }

        .header-left p {
            font-size: 0.9em;
            opacity: 0.85;
            font-weight: 300;
            color: #B0B3B8;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .upload-btn-header {
            background: #23272A;
            color: #E0E0E0;
            border: none;
            padding: 6px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .upload-btn-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(35, 39, 42, 0.18);
            background: #313338;
        }

        .upload-btn-header:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #uploadInput {
            display: none;
        }

        .upload-status {
            font-size: 0.85em;
            color: #90caf9;
            padding: 8px 12px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 8px;
            display: none;
        }

        .upload-status.show {
            display: block;
        }

        .upload-success {
            color: #81c784;
            background: rgba(129, 199, 132, 0.1);
        }

        .upload-error {
            color: #ff7043;
            background: rgba(255, 112, 67, 0.1);
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #202124;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-area::-webkit-scrollbar {
            width: 8px;
        }

        .chat-area::-webkit-scrollbar-track {
            background: #1a2540;
        }

        .chat-area::-webkit-scrollbar-thumb {
            background: #42a5f5;
            border-radius: 4px;
        }

        .chat-area::-webkit-scrollbar-thumb:hover {
            background: #64b5f6;
        }

        .message {
            display: flex;
            margin-bottom: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 75%;
            padding: 14px 18px;
            border-radius: 12px;
            font-size: 0.95em;
            line-height: 1.6;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #23272A;
            color: #E0E0E0;
            border-bottom-right-radius: 4px;
            box-shadow: 0 4px 12px rgba(35, 39, 42, 0.12);
        }

        .message.bot .message-content {
            background: #23272A;
            color: #B0B3B8;
            border: 1px solid #313338;
            border-bottom-left-radius: 4px;
        }

        .loading {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 14px 18px;
            background: #1a3a52;
            border: 1px solid #42a5f5;
            border-radius: 12px;
            width: fit-content;
        }

        .loading span {
            width: 8px;
            height: 8px;
            background: #42a5f5;
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .loading span:nth-child(1) {
            animation-delay: 0s;
        }

        .loading span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        .input-area {
            padding: 20px 25px;
            background: #0d1b2a;
            border-top: 1px solid #1a5e8a;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            gap: 10px;
        }

        #queryInput {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid #313338;
            border-radius: 12px;
            font-size: 0.95em;
            font-family: inherit;
            transition: all 0.3s ease;
            resize: none;
            max-height: 100px;
            background: #202124;
            color: #E0E0E0;
        }

        #queryInput:focus {
            outline: none;
            border-color: #B0B3B8;
            box-shadow: 0 0 0 3px rgba(176, 179, 184, 0.08);
        }

        #queryInput::placeholder {
            color: #6C6F74;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #sendBtn {
            background: #313338;
            color: #E0E0E0;
            box-shadow: 0 4px 12px rgba(35, 39, 42, 0.12);
            padding: 14px 28px;
            font-size: 1.1em;
            min-width: 60px;
            justify-content: center;
        }

        #sendBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(35, 39, 42, 0.12);
            background: #23272A;
        }

        #sendBtn:active:not(:disabled) {
            transform: translateY(0);
        }

        #sendBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #clearBtn {
            background: #23272A;
            color: #B0B3B8;
            border: 1px solid #313338;
        }

        #clearBtn:hover {
            background: #313338;
            color: #E0E0E0;
            transform: translateY(-2px);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            color: #64b5f6;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.6;
            stroke: #42a5f5;
        }

        .empty-state p {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #90caf9;
        }

        .empty-state small {
            color: #64b5f6;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            color: #ff7043;
            padding: 12px 18px;
            border-radius: 12px;
            border-left: 4px solid #ff6b6b;
        }

        /* Markdown content styling */
        .markdown-content {
            word-wrap: break-word;
        }

        .markdown-content h3 {
            color: #42a5f5;
            font-size: 1.3em;
            margin: 18px 0 12px 0;
            font-weight: 600;
            border-left: 4px solid #42a5f5;
            padding-left: 12px;
        }

        .markdown-content h3:first-child {
            margin-top: 0;
        }

        .property-heading {
            color: #42a5f5 !important;
            font-size: 1.3em !important;
            margin: 18px 0 12px 0 !important;
            font-weight: 600 !important;
            border-left: 4px solid #42a5f5;
            padding-left: 12px;
            display: block;
        }

        .property-label {
            color: #64b5f6;
            font-weight: 600;
            display: inline;
        }

        .markdown-content strong {
            color: #64b5f6;
            font-weight: 600;
        }

        .property-text {
            margin: 8px 0;
            line-height: 1.6;
            color: #e3f2fd;
        }

        .property-list {
            list-style: none;
            padding-left: 0;
            margin: 8px 0;
        }

        .property-item {
            color: #90caf9;
            margin: 6px 0 6px 20px;
            padding-left: 8px;
            border-left: 2px solid #42a5f5;
            padding-left: 12px;
        }

        .property-item::before {
            content: "";
        }

        .property-divider {
            border: none;
            border-top: 2px dashed #42a5f5;
            margin: 20px 0;
            opacity: 0.5;
        }

        .markdown-content hr {
            border: none;
            border-top: 2px dashed #42a5f5;
            margin: 20px 0;
            opacity: 0.5;
        }

        @media (max-width: 1200px) {
            .sidebar {
                width: 200px;
                padding: 20px 15px;
            }

            .filter-btn {
                font-size: 0.85em;
                padding: 10px 12px;
            }
        }

        @media (max-width: 900px) {
            .sidebar {
                display: none;
            }

            .main-container {
                margin-left: 0;
            }

            .message-content {
                max-width: 85%;
                font-size: 0.9em;
            }

            .header-left h1 {
                font-size: 1.6em;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>üîç Quick Filters</h3>
        </div>
        
        <div class="quick-filters">
            <button class="filter-btn" onclick="filterSearch('buy')">üè† Buy Properties</button>
            <button class="filter-btn" onclick="filterSearch('rent')">üîë Rent Properties</button>
            <button class="filter-btn" onclick="filterSearch('apartments')">üè¢ Apartments</button>
            <button class="filter-btn" onclick="filterSearch('villas')">üèõÔ∏è Villas</button>
            <button class="filter-btn" onclick="filterSearch('houses')">üèòÔ∏è Houses</button>
        </div>

        <div class="sidebar-divider"></div>

        <div class="info-box">
            <strong>üí° Try asking:</strong><br>
            ‚Ä¢ "Find 2 BHK apartments"<br>
            ‚Ä¢ "Properties in Pune"<br>
            ‚Ä¢ "Villas for sale"<br>
            ‚Ä¢ "Budget-friendly rentals"<br>
            ‚Ä¢ "Properties with amenities"
        </div>

        <div class="sidebar-divider"></div>

        <div class="info-box">
            <strong>‚ú® Features:</strong><br>
            ‚Ä¢ AI-powered search<br>
            ‚Ä¢ Real-time answers<br>
            ‚Ä¢ Detailed property info<br>
            ‚Ä¢ Contact information
        </div>
    </div>

    <div class="main-container">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <h1><strong>Smart Property Hub</strong></h1>
                    <p>Your AI-Powered Real Estate Assistant</p>
                </div>
                <div class="header-right">
                    <input type="file" id="uploadInput" accept=".pdf" />
                    <button class="upload-btn-header" onclick="document.getElementById('uploadInput').click()" title="Upload PDF">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                            <span>üì§ Upload PDF</span>
                            <small style="font-size: 0.5em; opacity: 0.65;">For admin use</small>
                        </div>
                    </button>
                    <div class="upload-status" id="uploadStatus"></div>
                </div>
            </div>

            <div class="chat-area" id="chatArea">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                    <p>Welcome to Smart Property Hub!</p>
                    <small>Ask me anything about properties, rentals, or real estate details</small>
                </div>
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <textarea 
                        id="queryInput" 
                        placeholder="Ask me about properties... (e.g., 'Find apartments for rent in downtown')"
                        rows="1"
                    ></textarea>
                </div>
                <div class="controls">
                    <button id="sendBtn" title="Send message (Enter)">
                        <span>üì§ Send</span>
                    </button>
                    <button id="clearBtn" title="Clear chat">
                        <span>üóëÔ∏è</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatArea = document.getElementById('chatArea');
        const queryInput = document.getElementById('queryInput');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const uploadInput = document.getElementById('uploadInput');
        const uploadStatus = document.getElementById('uploadStatus');

        const API_URL = 'http://localhost:8000';
        let currentFilter = '';

        // Filter search functionality
        function filterSearch(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            queryInput.value = `Show me ${filter} properties in Pune`;
            queryInput.focus();
        }

        // File upload functionality
        uploadInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (!file.name.toLowerCase().endsWith('.pdf')) {
                showUploadStatus('‚ùå Please select a PDF file', 'error');
                return;
            }

            showUploadStatus('üì§ Uploading...', 'loading');
            const uploadBtn = document.querySelector('.upload-btn-header');
            uploadBtn.disabled = true;

            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('source_name', file.name);

                const response = await fetch(`${API_URL}/upload/`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Upload failed');
                }

                const data = await response.json();
                showUploadStatus(`‚úÖ Uploaded! ${data.chunks_processed} chunks`, 'success');
                
                addMessage(`üìÑ PDF uploaded successfully!\n\nFile: ${file.name}\nChunks processed: ${data.chunks_processed}\n\nYou can now ask questions about this document!`, 'bot');
                
                uploadInput.value = '';

            } catch (error) {
                showUploadStatus(`‚ùå Error: ${error.message}`, 'error');
                console.error('Upload error:', error);
            } finally {
                uploadBtn.disabled = false;
            }
        });

        function showUploadStatus(message, type) {
            uploadStatus.textContent = message;
            uploadStatus.classList.add('show');
            uploadStatus.className = `upload-status show ${type === 'error' ? 'upload-error' : type === 'success' ? 'upload-success' : ''}`;
            
            if (type === 'success') {
                setTimeout(() => {
                    uploadStatus.classList.remove('show');
                }, 3000);
            }
        }

        // Auto-resize textarea
        queryInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        // Send message on button click
        sendBtn.addEventListener('click', sendMessage);

        // Send message on Enter (Shift+Enter for new line)
        queryInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Clear chat
        clearBtn.addEventListener('click', function() {
            chatArea.innerHTML = `
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                    <p>Welcome to Smart Property Hub!</p>
                    <small>Ask me anything about properties, rentals, or real estate details</small>
                </div>
            `;
            currentFilter = '';
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        });

        async function sendMessage() {
            const query = queryInput.value.trim();
            if (!query) return;

            addMessage(query, 'user');
            queryInput.value = '';
            queryInput.style.height = 'auto';
            sendBtn.disabled = true;

            const loadingId = addLoadingMessage();

            try {
                const response = await fetch(`${API_URL}/query/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        top_k: 5
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API Error ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                removeLoadingMessage(loadingId);

                if (data.results && data.results.length > 0) {
                    data.results.forEach((result, index) => {
                        if (result.text) {
                            addMessage(result.text, 'bot', true);
                        } else {
                            addMessage(`${index + 1}. ${JSON.stringify(result, null, 2)}`, 'bot', false);
                        }
                    });
                } else {
                    addMessage('No properties found matching your query. Try a different search.', 'bot', false);
                }

            } catch (error) {
                removeLoadingMessage(loadingId);
                addMessage(`‚ùå Error: ${error.message}\n\nüí° Make sure your FastAPI server is running on http://localhost:8000`, 'bot error');
                console.error('Error:', error);
            } finally {
                sendBtn.disabled = false;
                queryInput.focus();
            }
        }

        function addMessage(text, sender, isMarkdown = false) {
            const emptyState = chatArea.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            if (sender === 'bot error') {
                contentDiv.classList.add('error-message');
                contentDiv.textContent = text;
            } else {
                // Always show plain text for bot responses (simple, standard)
                contentDiv.textContent = text;
            }

            messageDiv.appendChild(contentDiv);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // parseMarkdown function removed for simple/plain text output

        function addLoadingMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.id = `loading-${Date.now()}`;
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.innerHTML = '<span></span><span></span><span></span>';
            
            messageDiv.appendChild(loadingDiv);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            return messageDiv.id;
        }

        function removeLoadingMessage(loadingId) {
            const loadingElement = document.getElementById(loadingId);
            if (loadingElement) {
                loadingElement.remove();
            }
        }

        queryInput.focus();
    </script>
</body>
</html>
